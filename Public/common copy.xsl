<?xml version="1.0" encoding="utf-8"?><xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">	<xsl:import href="../common/common.xsl"/>	<xsl:param name="big_preview_height" select="540"/>	<xsl:param name="red" select="'ed1f24'"/>	<xsl:param name="small_preview_height" select="90"/>	<xsl:template name="html">		<html>			<xsl:call-template name="attribute_html"/>			<head>				<xsl:call-template name="html_head"/>			</head>			<body>				<xsl:apply-templates select="$media" mode="body_attribute"/>				<div id="container">					<xsl:apply-templates select="$website" mode="top"/>					<xsl:apply-templates select="$website" mode="navigation"/>					<xsl:apply-templates select="$media" mode="content"/>					<xsl:apply-templates select="$website" mode="bottom"/>				</div>			</body>		</html>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Selection' or INFO/MEDIATYPE = 'Book' or INFO/PAGETOCALL = 'Rules.php']" mode="specific_head_content">		<script type="text/javascript" src="{//NECTIL/public_url}jquery.smoothanchors2.js"> </script>	</xsl:template>	<xsl:template match="MEDIA" mode="h1">		<h1>			<xsl:call-template name="titrage">				<xsl:with-param name="text">					<xsl:apply-templates select="." mode="title"/>				</xsl:with-param>				<xsl:with-param name="color" select="$red"/>				<xsl:with-param name="size" select="30"/>				<xsl:with-param name="font" select="'bold'"/>			</xsl:call-template>		</h1>	</xsl:template>	<xsl:template match="MEDIA[/RESPONSE/RESULTS[@name='media']/MEDIA/@ID = /RESPONSE/RESULTS[@name='website']/MEDIA/@ID]" mode="h1">		<xsl:param name="title">			<xsl:apply-templates select="." mode="title"/>		</xsl:param>		<h1>			<xsl:call-template name="titrage">				<xsl:with-param name="text" select="translate($title, $minuscules, $majuscules)"/>				<xsl:with-param name="color" select="'000000'"/>				<xsl:with-param name="size" select="60"/>				<xsl:with-param name="font" select="'light'"/>			</xsl:call-template>		</h1>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='Website']" mode="body_attribute">		<xsl:variable name="number" select="count($media/DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA) + count($data)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">			<xsl:value-of select="INFO/MEDIATYPE"/>		</xsl:attribute>		<xsl:attribute name="style">			<xsl:variable name="images_width" select="720"/>			<xsl:variable name="width" select="round($images_width * $number + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[( (INFO/MEDIATYPE='Selection') and not(//URL/mode = 'text') )]" mode="body_attribute">		<xsl:variable name="number" select="count($data)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">			<xsl:value-of select="INFO/MEDIATYPE"/>			<xsl:text> fix</xsl:text>		</xsl:attribute>		<xsl:attribute name="style">			<xsl:variable name="images_width" select="sum($data/DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL/@width)"/>			<xsl:variable name="images_average_height" select="round(sum($data/DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL/@height) div $number)"/>			<xsl:variable name="width" select="round($images_width div $images_average_height * $big_preview_height + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[( (INFO/MEDIATYPE='Book') and not(//URL/mode = 'text') )]" mode="body_attribute">		<xsl:variable name="number" select="count(DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">			<xsl:value-of select="INFO/MEDIATYPE"/>			<xsl:text> fix</xsl:text>		</xsl:attribute>		<xsl:attribute name="style">			<xsl:variable name="images_width" select="sum(DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE/@width)"/>			<xsl:variable name="images_average_height" select="round(sum(DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE/@height) div $number)"/>			<xsl:variable name="width" select="round($images_width div $images_average_height * $big_preview_height + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA" mode="body_attribute">		<xsl:apply-templates select="." mode="attribute"/>	</xsl:template>	<xsl:template match="MEDIA" mode="top"/>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="top">		<div id="top">			<a>				<xsl:apply-templates select="." mode="href"/>				<img src="{$files}{DESCRIPTIONS/DESCRIPTION/CUSTOM/Logo}">					<xsl:attribute name="alt">						<xsl:apply-templates select="." mode="title"/>					</xsl:attribute>				</img>			</a>		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="bottom_script"/>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="bottom_script">		<script>			<xsl:text>resize_body('content');</xsl:text>		</script>	</xsl:template>	<xsl:template match="MEDIA[INFO/PAGETOCALL = 'Rules.php']" mode="bottom_script">		<script>			<xsl:text>$(document).ready(function(){$.smoothAnchors("normal", "linear", false);});</xsl:text>		</script>	</xsl:template>	<xsl:template match="MEDIA[(INFO/MEDIATYPE = 'Selection' or INFO/MEDIATYPE = 'Book')and not(//URL/mode = 'text')]" mode="bottom_script">		<script>			<xsl:text>resize_preview_image();</xsl:text>			<xsl:text>resize_body();</xsl:text>			<xsl:text>$(document).ready(function(){$.smoothAnchors("normal", "linear", false);});</xsl:text>		</script>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="bottom">		<div id="bottom"/>		<xsl:apply-templates select="." mode="bottom_script"/>		<xsl:apply-templates select="$media" mode="bottom_script"/>	</xsl:template>	<xsl:template match="MEDIA" mode="bottom">	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="content">		<div id="content">			<xsl:apply-templates select="." mode="specific"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Page']" mode="content">		<div id="content">			<xsl:apply-templates select="." mode="h1"/>			<xsl:apply-templates select="." mode="body"/>			<xsl:apply-templates select="." mode="specific"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='Menu']" mode="href">		<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaNavigation']/MEDIA[1]" mode="href"/>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='News']" mode="href">		<xsl:attribute name="href">			<xsl:text>NewsList.php?ID=3509#m</xsl:text>			<xsl:value-of select="@ID"/>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA]" mode="specific">		<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[1]" mode="website_preview"/>		<xsl:apply-templates select="$data" mode="website_preview"/>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and not(DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA)]" mode="specific">		<xsl:apply-templates select="$data" mode="website_preview"/>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Page']" mode="specific">		<div id="specific">			<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA" mode="in_content"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Paragraph']" mode="in_content">		<div id="m{@ID}">			<xsl:apply-templates match="." mode="attribute"/>			<xsl:apply-templates select="." mode="body"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Links']" mode="in_content">		<div id="m{@ID}">			<xsl:apply-templates select="." mode="attribute"/>			<xsl:apply-templates select="." mode="link"/>		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="website_preview">		<div class="preview {INFO/MEDIATYPE}">			<div class="image">				<xsl:apply-templates select="." mode="visual">					<xsl:with-param name="height" select="$big_preview_height"/>				</xsl:apply-templates>			</div>			<div class="title">				<xsl:apply-templates select="." mode="h1"/>			</div>			<div class="info">				<xsl:apply-templates select="." mode="website_preview_info"/>			</div>		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="website_preview_info">		<p>			<xsl:value-of select="DESCRIPTIONS/DESCRIPTION/BODY/*[1]"/>		</p>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'News']" mode="website_preview_info">		<xsl:apply-templates select="." mode="header"/>		<xsl:apply-templates select="." mode="more"/>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Book']" mode="website_preview_info">		<xsl:apply-templates select="/RESPONSE/DISPLAY" mode="display">			<xsl:with-param name="element" select="."/>		</xsl:apply-templates>	</xsl:template>	<xsl:template match="MEDIA" mode="big_preview_info">		<xsl:apply-templates select="." mode="website_preview_info"/>	</xsl:template>	<xsl:template match="MEDIA" mode="inside_navigation_item">		<li>			<a href="#m{@ID}">				<xsl:apply-templates select="." mode="title"/>			</a>		</li>	</xsl:template>	<xsl:template match="MEDIA" mode="big_preview">		<xsl:variable name="visual" select="DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL"/>		<div class="{INFO/MEDIATYPE} preview gouttiere" id="m{@ID}">			<xsl:attribute name="style">				<xsl:text>width:</xsl:text>				<xsl:value-of select="round($visual/@width div $visual/@height *$big_preview_height)"/>				<xsl:text>px;</xsl:text>			</xsl:attribute>			<a name="m{@ID}"/>			<ul class="preview_navigation">				<xsl:if test="preceding-sibling::MEDIA">					<li>						<a href="#m{preceding-sibling::MEDIA[1]/@ID}">							<xsl:text>←</xsl:text>						</a>					</li>				</xsl:if>				<xsl:if test="following-sibling::MEDIA">					<li>						<a href="#m{following-sibling::MEDIA/@ID}">							<xsl:text>→</xsl:text>						</a>					</li>				</xsl:if>			</ul>			<xsl:apply-templates select="." mode="h4"/>			<xsl:apply-templates select="." mode="visual">				<xsl:with-param name="height" select="$big_preview_height"/>			</xsl:apply-templates>			<div class="info">				<xsl:apply-templates select="." mode="big_preview_info"/>			</div>		</div>	</xsl:template>	<xsl:template match="FILE" mode="big_preview">		<xsl:variable name="visual" select="@path"/>		<div class="preview gouttiere" id="f{@shortname}">			<xsl:attribute name="style">				<xsl:text>width:</xsl:text>				<xsl:value-of select="round(@width div @height *$big_preview_height)"/>				<xsl:text>px;</xsl:text>			</xsl:attribute>			<a name="f{@shortname}"/>			<ul class="preview_navigation">				<xsl:if test="preceding-sibling::FILE">					<li>						<a href="#f{preceding-sibling::FILE[1]/@shortname}">							<xsl:text>←</xsl:text>						</a>					</li>				</xsl:if>				<xsl:if test="following-sibling::FILE">					<li>						<a href="#f{following-sibling::FILE/@shortname}">							<xsl:text>→</xsl:text>						</a>					</li>				</xsl:if>			</ul>			<!--xsl:apply-templates select="." mode="h4"/-->			<xsl:apply-templates select="." mode="visual">				<xsl:with-param name="height" select="$big_preview_height"/>			</xsl:apply-templates>			<!--div class="info">				<xsl:apply-templates select="." mode="big_preview_info"/>			</div-->		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="small_preview">		<xsl:param name="height" select="$small_preview_height"/>		<div id="m{@ID}">			<xsl:attribute name="class">				<xsl:value-of select="INFO/MEDIATYPE"/>				<xsl:text> small_preview gouttiere gouttiere_hor </xsl:text>				<xsl:if test="//NECTIL/this_script = 'Books.php'">					<xsl:for-each select="CATEGORIES/CATEGORY | DEPENDENCIES/DEPENDENCY/CONTACT">						<xsl:value-of select="concat(substring(name(), 1, 3),@ID)"/>						<xsl:text> </xsl:text>					</xsl:for-each>					<xsl:value-of select="DESCRIPTIONS/DESCRIPTION/CUSTOM/YEAR"/>				</xsl:if>			</xsl:attribute>			<a onmouseover="$('#m{@ID} h6').css('display', 'block');" onmouseout="$('#m{@ID} h6').css('display', 'none');">				<xsl:apply-templates select="." mode="href"/>				<h6>					<span>						<xsl:apply-templates select="." mode="title"/>					</span>				</h6>				<xsl:apply-templates select="." mode="visual">					<xsl:with-param name="height" select="$height"/>				</xsl:apply-templates>			</a>		</div>	</xsl:template></xsl:stylesheet>