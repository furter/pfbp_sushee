<?xml version="1.0"?><xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">	<xsl:import href="common.xsl"/>	<xsl:template match="/RESPONSE">		<xsl:call-template name="html"/>	</xsl:template>	<xsl:template match="MEDIA" mode="content">		<div id="content">			<xsl:apply-templates select="." mode="h1"/>			<xsl:apply-templates select="." mode="body"/>			<form name="SearchBooks" id="SearchBooks" action="Books.php">				<input type="hidden" name="ID" value="{$ID}"/>				<xsl:call-template name="form_input_text">					<xsl:with-param name="name" select="'search'"/>					<xsl:with-param name="label" select="//LABEL[@name='free_search']"/>					<xsl:with-param name="onkeypress" select="'return disableEnterKey(event); '"/>				</xsl:call-template>				<div class="button_container">					<a href="#" onclick="search_books();">						<xsl:value-of select="//LABEL[@name='f_search']"/>					</a>				</div>				<hr class="clear"/>			</form>			<xsl:apply-templates select="//CONFIG/FORM[@name='BrowseBooks']" mode="config">				<xsl:with-param name="onchange" select="'refresh_book_listing();'"/>			</xsl:apply-templates>		</div>		<xsl:apply-templates select="." mode="specific"/>	</xsl:template>	<xsl:template match="MEDIA" mode="specific">		<div id="specific">			<h2>				<span class="total">					<xsl:value-of select="count($data)"/>					<xsl:text> </xsl:text>					<xsl:value-of select="//LABEL[@name='search_many_books']"/>				</span>				<xsl:text> </xsl:text>				<span class="end">					<xsl:value-of select="//LABEL[@name='search_books_found']"/>				</span>			</h2>			<table>				<tr>					<th/>					<th>						<xsl:value-of select="//LABEL[@name='book_TITLE']"/>					</th>					<xsl:for-each select="$data[1]/DEPENDENCIES/DEPENDENCY[starts-with(@type, 'BookTo')]">						<xsl:variable name="label" select="concat('book_', @type)"/>						<th>							<xsl:value-of select="//LABEL[@name=$label]"/>						</th>					</xsl:for-each>					<th/>					<th/>				</tr>				<xsl:for-each select="$data">					<!--					<xsl:sort select="DESCRIPTIONS/DESCRIPTION/CUSTOM/YEAR" data-type="number" order="descending"/>					<xsl:sort select="CATEGORIES/CATEGORY[FATHERNAME='candidat']/@ID" data-type="number" order="descending"/>					-->					<xsl:sort select="translate(DESCRIPTIONS/DESCRIPTION/TITLE, $majuscules, $sans_accent)" data-type="text" order="ascending"/>					<xsl:apply-templates select="." mode="small_preview">						<xsl:with-param name="height" select="120"/>					</xsl:apply-templates>				</xsl:for-each>			</table>		</div>	</xsl:template>	<xsl:template match="CATEGORY" mode="select_option">		<xsl:if test="not(contains(@path, 'concours')) or @ID = 22 or @ID = 23 or @ID = 57">			<xsl:call-template name="form_select_option">				<xsl:with-param name="label" select="LABEL"/>				<xsl:with-param name="value" select="concat('CAT',@ID)"/>			</xsl:call-template>		</xsl:if>		<xsl:apply-templates select="CATEGORY" mode="select_option"/>	</xsl:template>	<xsl:template match="CONTACT" mode="select_option">		<xsl:call-template name="form_select_option">			<xsl:with-param name="label">				<xsl:apply-templates select="." mode="title"/>			</xsl:with-param>			<xsl:with-param name="value" select="concat('CON',@ID)"/>		</xsl:call-template>	</xsl:template>	<xsl:template match="MEDIA" mode="specific_head_content_init">		<script>			<xsl:text>no_book_found='</xsl:text>			<xsl:value-of select="//LABEL[@name='search_no_book_found']"/>			<xsl:text>'; one_book_found = '</xsl:text>			<xsl:value-of select="//LABEL[@name='search_book_found']"/>			<xsl:text>'; many_books_found = '</xsl:text>			<xsl:value-of select="//LABEL[@name='search_books_found']"/>			<xsl:text>';</xsl:text>			<xsl:text>no_book='</xsl:text>			<xsl:value-of select="//LABEL[@name='search_no_book']"/>			<xsl:text>'; one_book = '</xsl:text>			<xsl:value-of select="//LABEL[@name='search_one_book']"/>			<xsl:text>'; many_books = '</xsl:text>			<xsl:value-of select="//LABEL[@name='search_many_books']"/>			<xsl:text>';</xsl:text>			<xsl:text>function disableEnterKey(e) {    var key;         if(window.event){key = window.event.keyCode}    else {key = e.which;}	if (key == 13) {search_books();}	return (key != 13);	}			</xsl:text>		</script>	</xsl:template>	<xsl:template match="MEDIA" mode="small_preview">		<xsl:param name="height" select="$small_preview_height"/>		<tr id="m{@ID}">			<xsl:if test="CATEGORIES/CATEGORY[UNIQUENAME = 'laureat'] and DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL != ''">				<xsl:attribute name="onclick">					<xsl:text>document.location.href = '</xsl:text>					<xsl:value-of select="concat(INFO/MEDIATYPE, '.php?ID=',@ID)"/>					<xsl:text>';</xsl:text>				</xsl:attribute>				<xsl:attribute name="onmouseover">					$(this).css('color', '#ED1F24');				</xsl:attribute>				<xsl:attribute name="onmouseout">					$(this).css('color', 'black');				</xsl:attribute>			</xsl:if>			<xsl:attribute name="class">				<xsl:if test="CATEGORIES/CATEGORY[UNIQUENAME = 'laureat'] and DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL != ''">					<xsl:text>laureat </xsl:text>				</xsl:if>				<xsl:text>Book </xsl:text>				<xsl:for-each select="CATEGORIES/CATEGORY | DEPENDENCIES/DEPENDENCY/CONTACT">					<xsl:value-of select="concat(substring(name(), 1, 3),@ID)"/>					<xsl:text> </xsl:text>				</xsl:for-each>				<xsl:value-of select="DESCRIPTIONS/DESCRIPTION/CUSTOM/YEAR"/>			</xsl:attribute>			<td class="concours">				<xsl:if test="CATEGORIES/CATEGORY[UNIQUENAME = 'laureat']">					<img src="images/petit_losange.png" alt="{CATEGORIES/CATEGORY[UNIQUENAME = 'laureat']/LABEL}"/>				</xsl:if>			</td>			<td class="title">				<xsl:apply-templates select="." mode="title"/>			</td>			<xsl:for-each select="DEPENDENCIES/DEPENDENCY[starts-with(@type, 'BookTo')]">				<xsl:variable name="desc_field" select="translate(substring(@type, 7), $minuscules, $majuscules)"/>				<xsl:variable name="description" select="../../DESCRIPTIONS/DESCRIPTION"/>				<td class="@type">					<xsl:choose>						<xsl:when test="$description/CUSTOM/*[name() = $desc_field] != ''">							<xsl:value-of select="$description/CUSTOM/*[name() = $desc_field]"/>						</xsl:when>						<xsl:otherwise>							<xsl:for-each select="*">								<xsl:apply-templates select="." mode="title"/>								<xsl:if test="position() != last()">									<xsl:text>, </xsl:text>								</xsl:if>							</xsl:for-each>						</xsl:otherwise>					</xsl:choose>									</td>			</xsl:for-each>			<td class="year">				<xsl:value-of select="CATEGORIES/CATEGORY[@fatherID = 37]/LABEL"/>			</td>			<td>				<xsl:if test="CATEGORIES/CATEGORY[UNIQUENAME = 'laureat']">					<xsl:apply-templates select="." mode="visual">						<xsl:with-param name="height" select="40"/>					</xsl:apply-templates>				</xsl:if>			</td>			<!--xsl:apply-templates select="." mode="visual">				<xsl:with-param name="height" select="$height"/>			</xsl:apply-templates-->		</tr>	</xsl:template></xsl:stylesheet>