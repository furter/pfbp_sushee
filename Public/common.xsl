<?xml version="1.0" encoding="utf-8"?><xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">	<xsl:import href="../common/common.xsl"/>	<xsl:param name="big_preview_height" select="540"/>	<xsl:param name="red" select="'ed1f24'"/>	<xsl:param name="small_preview_height" select="90"/>	<xsl:param name="step_width" select="300"/>	<xsl:template name="html">		<html>			<xsl:call-template name="attribute_html"/>			<head>				<xsl:call-template name="html_head"/>			</head>			<body mID="{$media/@ID}">				<xsl:apply-templates select="$media" mode="body_attribute"/>				<div id="container">					<xsl:apply-templates select="$website" mode="top"/>					<xsl:apply-templates select="$website" mode="navigation"/>					<xsl:apply-templates select="$media" mode="content"/>				</div>				<xsl:apply-templates select="$website" mode="bottom"/>			</body>		</html>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Selection' or INFO/PAGETOCALL = 'Rules.php' or INFO/MEDIATYPE = 'Book']" mode="specific_head_content">		<script type="text/javascript" src="{//NECTIL/public_url}jquery.smoothanchors2.js">Â </script>		<script type="text/javascript">			<xsl:text>$(document).ready(function(){$.smoothAnchors("normal", "linear", false);});</xsl:text>		</script>	</xsl:template>	<xsl:template match="/RESPONSE/RESULTS[@name='media']/MEDIA[INFO/MEDIATYPE='Website']" mode="specific_head_content">		<script type="text/javascript" src="2010.js"> </script>	</xsl:template>	<xsl:template match="MEDIA[DEPENDENCIES/DEPENDENCY[@type='mediaNavigation']/MEDIA/INFO/MEDIATYPE = 'Selection']" mode="active">		<xsl:if test="$ID = @ID or DEPENDENCIES/DEPENDENCY[@type='mediaNavigation']/MEDIA/@ID = $ID or $media/INFO/MEDIATYPE = 'Book'">			<xsl:attribute name="class">active</xsl:attribute>		</xsl:if>	</xsl:template>	<xsl:template match="MEDIA" mode="h1">		<xsl:variable name="text">			<xsl:apply-templates select="." mode="title"/>		</xsl:variable>		<h1>			<!--			<xsl:call-template name="titrage">				<xsl:with-param name="text" select="translate($text, $minuscules, $majuscules)"/>				<xsl:with-param name="color" select="$red"/>				<xsl:with-param name="size" select="24"/>				<xsl:with-param name="font" select="'book'"/>			</xsl:call-template>			-->			<xsl:apply-templates select="." mode="title"/>		</h1>	</xsl:template>	<xsl:template match="MEDIA[/RESPONSE/RESULTS[@name='media']/MEDIA/@ID = /RESPONSE/RESULTS[@name='website']/MEDIA/@ID]" mode="h1">		<xsl:param name="title">			<xsl:apply-templates select="." mode="title"/>		</xsl:param>		<h1>			<xsl:call-template name="titrage">				<xsl:with-param name="text" select="translate($title, $minuscules, $majuscules)"/>				<xsl:with-param name="color" select="'000000'"/>				<xsl:with-param name="size" select="60"/>				<xsl:with-param name="font" select="'light'"/>			</xsl:call-template>		</h1>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='Website']" mode="body_attribute">		<xsl:variable name="number" select="count($media/DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[INFO/MEDIATYPE != 'Paragraph']) + count($data)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">			<xsl:value-of select="INFO/MEDIATYPE"/>		</xsl:attribute>		<xsl:attribute name="style">			<xsl:variable name="images_width" select="720"/>			<xsl:variable name="width" select="round($images_width * $number + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[( (INFO/MEDIATYPE='Selection') and not(//URL/mode = 'text') )]" mode="body_attribute">		<xsl:variable name="number" select="count($data)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">			<xsl:value-of select="INFO/MEDIATYPE"/>			<xsl:text> fix</xsl:text>		</xsl:attribute>		<xsl:attribute name="style">			<xsl:variable name="images_width" select="sum($data/DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL/@width)"/>			<xsl:variable name="images_average_height" select="round(sum($data/DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL/@height) div $number)"/>			<xsl:variable name="width" select="round($images_width div $images_average_height * $big_preview_height + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[( (INFO/MEDIATYPE='Book') and not(//URL/mode = 'text') )]" mode="body_attribute">		<xsl:variable name="number" select="count(DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">			<xsl:value-of select="INFO/MEDIATYPE"/>			<xsl:text> fix</xsl:text>		</xsl:attribute>		<xsl:attribute name="style">			<xsl:variable name="images_width" select="sum(DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE/@width)"/>			<xsl:variable name="images_average_height" select="round(sum(DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE/@height) div $number)"/>			<xsl:variable name="width" select="round($images_width div $images_average_height * $big_preview_height + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='BookSubmission']" mode="body_attribute">		<xsl:variable name="number" select="count(DEPENDENCIES/DEPENDENCY/MEDIA)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">			<xsl:value-of select="INFO/MEDIATYPE"/>			<xsl:text> fix</xsl:text>		</xsl:attribute>		<!--			<xsl:attribute name="style">			<xsl:variable name="width" select="round( $number * $step_width + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>		-->	</xsl:template>	<xsl:template match="MEDIA" mode="body_attribute">		<xsl:apply-templates select="." mode="attribute"/>	</xsl:template>	<xsl:template match="MEDIA" mode="top"/>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="top">		<div id="languages">			<ul>				<xsl:for-each select="//RESULTS/LANGUAGE">					<li>						<a href="{//NECTIL/language_url}language={@ID}">							<xsl:if test="@ID = //NECTIL/language">								<xsl:attribute name="class">active</xsl:attribute>							</xsl:if>							<xsl:value-of select="@ID"/>						</a>					</li>				</xsl:for-each>			</ul>		</div>		<div id="top">			<a>				<xsl:apply-templates select="." mode="href"/>				<img src="{$files}{DESCRIPTIONS/DESCRIPTION/CUSTOM/Logo}">					<xsl:attribute name="alt">						<xsl:apply-templates select="." mode="title"/>					</xsl:attribute>				</img>			</a>		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="bottom_script"/>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and //URL/ID = @ID]" mode="bottom_script">		<!--script>			<xsl:text>resize_preview_image();</xsl:text>		</script-->	</xsl:template>	<xsl:template match="MEDIA[(INFO/MEDIATYPE = 'Selection' or INFO/MEDIATYPE = 'Book')and not(//URL/mode = 'text')]" mode="bottom_script">		<script>			<xsl:text>resize_preview_image();</xsl:text>			<xsl:text>resize_body('specific');</xsl:text>		</script>	</xsl:template>	<xsl:template match="MEDIA[INFO/PAGETOCALL = 'Press.php']" mode="navigation_item">		<xsl:if test="//URL/press = 1">			<li>				<a>					<xsl:apply-templates select="." mode="href"/>					<xsl:apply-templates select="." mode="active"/>					<xsl:apply-templates select="." mode="title"/>				</a>			</li>		</xsl:if>	</xsl:template>	<xsl:template match="LANGUAGE" mode="navigation_item">		<xsl:variable name="label" select="concat('site_in_', @ID)"/>		<li>			<a href="{//NECTIL/language_url}language={@ID}">				<xsl:value-of select="//LABEL[@name=$label]"/>			</a>		</li>	</xsl:template>	<xsl:template match="MEDIA[INFO/PAGETOCALL = 'SwitchLanguage.php']" mode="navigation_item">		<xsl:for-each select="//RESULTS/LANGUAGE[@ID != //NECTIL/language]">			<xsl:apply-templates select="." mode="navigation_item"/>		</xsl:for-each>	</xsl:template>	<xsl:template match="MEDIA" mode="tools_navigation">		<ul class="Tools">			<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='Tools']/MEDIA" mode="navigation_item"/>		</ul>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="bottom">		<!--		<hr class="clear"/>		<div id="bottom">			<xsl:apply-templates select="." mode="tools_navigation"/>			<p>				<xsl:value-of select="DESCRIPTIONS/DESCRIPTION/COPYRIGHT"/>			</p>		</div>		-->		<xsl:if test="$media/@ID != $website/@ID">			<xsl:apply-templates select="." mode="bottom_script"/>		</xsl:if>		<xsl:apply-templates select="$media" mode="bottom_script"/>	</xsl:template>	<xsl:template match="MEDIA" mode="bottom">	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="content">		<div id="content">			<xsl:apply-templates select="." mode="specific"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/PAGETOCALL = 'JuryMemberForm.php']" mode="content">		<div id="content">			<xsl:apply-templates select="." mode="h1"/>			<xsl:apply-templates select="." mode="body"/>			<div id="specific">				<iframe src="https://spreadsheets.google.com/embeddedform?formkey=dElwQW5GaFhJamc1MXN0V1NVc1NVU2c6MQ" width="760" height="1200" frameborder="0" marginheight="0" marginwidth="0"/>			</div>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Page']" mode="content">		<div id="content">			<xsl:apply-templates select="." mode="h1"/>			<xsl:apply-templates select="." mode="body"/>			<xsl:apply-templates select="." mode="specific"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='Menu']" mode="href">		<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaNavigation']/MEDIA[1]" mode="href"/>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='News']" mode="href">		<xsl:attribute name="href">			<xsl:text>NewsList.php?ID=3509#m</xsl:text>			<xsl:value-of select="@ID"/>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA]" mode="specific">		<xsl:choose>			<xsl:when test="//URL/preview">				<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[@ID=//URL/preview]" mode="website_preview"/>			</xsl:when>			<xsl:otherwise>				<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[1]" mode="website_preview"/>			</xsl:otherwise>		</xsl:choose>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and (not(DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA) or //URL/test = 1)]" mode="specific">		<xsl:apply-templates select="$data" mode="website_preview"/>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Page']" mode="specific">		<div id="specific">			<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA" mode="in_content"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Paragraph']" mode="in_content">		<div id="m{@ID}">			<xsl:apply-templates match="." mode="attribute"/>			<xsl:apply-templates select="." mode="body"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Links']" mode="in_content">		<div id="m{@ID}">			<xsl:apply-templates select="." mode="attribute"/>			<xsl:apply-templates select="." mode="link"/>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Paragraph']" mode="website_preview">			</xsl:template>	<xsl:template match="MEDIA" mode="website_preview">		<div class="preview {INFO/MEDIATYPE}">			<div class="image">				<xsl:apply-templates select="." mode="visual">					<xsl:with-param name="height" select="$big_preview_height"/>				</xsl:apply-templates>			</div>			<div class="title">				<xsl:apply-templates select="." mode="h1"/>			</div>			<div class="info">				<xsl:apply-templates select="." mode="website_preview_info"/>			</div>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/PAGETOCALL = '2010.php']" mode="website_preview">		<div class="w2010">			<div class="anim">				<div class="bg">					<img src="images/bg-red-diagonal.png"/>				</div>				<div class="img_books">					<xsl:for-each select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA">						<img src="{$files}{DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL2}" id="img{@ID}" alt="{DESCRIPTIONS/DESCRIPTION/TITLE}" title="{DESCRIPTIONS/DESCRIPTION/TITLE}">							<xsl:if test="position() != 1">								<xsl:attribute name="style">display:none;</xsl:attribute>							</xsl:if>						</img>					</xsl:for-each>				</div>				<div class="year top left">					<img src="images/2010/2.png"/>				</div>				<div class="year top right">					<img src="images/2010/0.png"/>				</div>				<div class="year bottom left">					<img src="images/2010/1.png"/>				</div>				<div class="year bottom right">					<img src="images/2010/0.png"/>				</div>				<div class="imgtitle left middle">					<img src="images/2010/prix.png" style="height:75px;"/>				</div>				<div class="imgtitle bottom center">					<img src="images/2010/baudin.png"/>				</div>				<div class="imgtitle right middle">					<img src="images/2010/prijs.png" style="height:90px;"/>				</div>				<div class="imgtitle top center">					<img src="images/2010/fernand.png"/>					<ul class="subtitle">						<xsl:for-each select="DESCRIPTIONS/DESCRIPTION/BODY/CSS/*">							<li>								<xsl:copy-of select="./node()"/>							</li>						</xsl:for-each>					</ul>				</div>			</div>			<div class="books top">				<ul>					<xsl:for-each select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA">						<xsl:if test="position() &lt;=6">							<xsl:apply-templates select="." mode="in_2010_nav_item"/>						</xsl:if>					</xsl:for-each>				</ul>			</div>			<div class="books bottom">				<ul>					<xsl:for-each select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA">						<xsl:if test="position() &gt;6">							<xsl:apply-templates select="." mode="in_2010_nav_item"/>						</xsl:if>					</xsl:for-each>				</ul>			</div>		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="in_2010_nav_item">		<xsl:param name="ID" select="@ID"/>		<li id="li{@ID}">			<xsl:for-each select="//MEDIA[INFO/PAGETOCALL = '2010.php']/DEPENDENCIES/DEPENDENCY/MEDIA">				<xsl:if test="@ID = $ID">					<xsl:if test="position() = 1">						<xsl:attribute name="class">active</xsl:attribute>					</xsl:if>				</xsl:if>			</xsl:for-each>			<xsl:apply-templates select="." mode="title"/>			<xsl:if test="DESCRIPTIONS/DESCRIPTION/HEADER != ''">				<xsl:text>, </xsl:text>				<br/>				<xsl:value-of select="DESCRIPTIONS/DESCRIPTION/HEADER"/>			</xsl:if>		</li>	</xsl:template>	<xsl:template match="MEDIA" mode="website_preview_info">		<p>			<xsl:value-of select="DESCRIPTIONS/DESCRIPTION/BODY/*[1]"/>		</p>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'News']" mode="website_preview_info">		<xsl:apply-templates select="." mode="header"/>		<xsl:if test="DESCRIPTIONS/DESCRIPTION/BODY != ''">			<xsl:apply-templates select="." mode="more"/>		</xsl:if>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Book']" mode="website_preview_info">		<xsl:apply-templates select="/RESPONSE/DISPLAY" mode="display">			<xsl:with-param name="element" select="."/>		</xsl:apply-templates>	</xsl:template>	<xsl:template match="MEDIA" mode="big_preview_info">		<xsl:apply-templates select="." mode="website_preview_info"/>	</xsl:template>	<xsl:template match="MEDIA" mode="inside_navigation_item">		<li>			<a href="#m{@ID}">				<xsl:apply-templates select="." mode="title"/>			</a>		</li>	</xsl:template>	<xsl:template match="MEDIA" mode="big_preview">		<xsl:param name="display_info" select="1"/>		<xsl:param name="alone" select="1"/>		<xsl:variable name="visual" select="DESCRIPTIONS/DESCRIPTION/CUSTOM/VISUAL"/>		<div class="{INFO/MEDIATYPE} preview gouttiere" id="m{@ID}">			<xsl:attribute name="style">				<xsl:text>width:</xsl:text>				<xsl:value-of select="round($visual/@width div $visual/@height *$big_preview_height)"/>				<xsl:text>px;</xsl:text>			</xsl:attribute>			<a name="m{@ID}"/>			<ul class="preview_navigation">				<xsl:if test="$alone = 0">					<xsl:if test="preceding-sibling::MEDIA">						<li>							<a href="#m{preceding-sibling::MEDIA[1]/@ID}">								<xsl:call-template name="prev_arrow"/>							</a>						</li>					</xsl:if>					<xsl:if test="following-sibling::MEDIA">						<li>							<a href="#m{following-sibling::MEDIA/@ID}">								<xsl:call-template name="next_arrow"/>							</a>						</li>					</xsl:if>				</xsl:if>			</ul>			<xsl:apply-templates select="." mode="h4"/>			<a>				<xsl:attribute name="href">					<xsl:text>#m</xsl:text>					<xsl:choose>						<xsl:when test="following-sibling::MEDIA">							<xsl:value-of select="following-sibling::MEDIA/@ID"/>						</xsl:when>						<xsl:otherwise>							<xsl:value-of select="../MEDIA[1]/@ID"/>						</xsl:otherwise>					</xsl:choose>				</xsl:attribute>				<xsl:apply-templates select="." mode="visual">					<xsl:with-param name="height" select="$big_preview_height"/>					<xsl:with-param name="class" select="'preview_img'"/>				</xsl:apply-templates>			</a>			<xsl:if test="$display_info = 1">				<div class="info">					<xsl:apply-templates select="." mode="big_preview_info"/>				</div>			</xsl:if>		</div>	</xsl:template>	<xsl:template match="FILE" mode="big_preview">		<xsl:variable name="visual" select="@path"/>		<div class="preview gouttiere" id="f{@shortname}">			<xsl:attribute name="style">				<xsl:text>width:</xsl:text>				<xsl:value-of select="round(@width div @height *$big_preview_height)"/>				<xsl:text>px;</xsl:text>			</xsl:attribute>			<a name="f{@shortname}"/>			<ul class="preview_navigation">				<xsl:if test="preceding-sibling::FILE">					<li>						<a href="#f{preceding-sibling::FILE[1]/@shortname}">							<xsl:call-template name="prev_arrow"/>						</a>					</li>				</xsl:if>				<xsl:if test="following-sibling::FILE">					<li>						<a href="#f{following-sibling::FILE/@shortname}">							<xsl:call-template name="next_arrow"/>						</a>					</li>				</xsl:if>			</ul>			<!--xsl:apply-templates select="." mode="h4"/-->			<a>				<xsl:attribute name="href">					<xsl:text>#f</xsl:text>					<xsl:choose>						<xsl:when test="following-sibling::FILE">							<xsl:value-of select="following-sibling::FILE/@shortname"/>						</xsl:when>						<xsl:otherwise>							<xsl:value-of select="../FILE[1]/@shortname"/>						</xsl:otherwise>					</xsl:choose>				</xsl:attribute>				<xsl:apply-templates select="." mode="visual">					<xsl:with-param name="height" select="$big_preview_height"/>					<xsl:with-param name="class" select="'preview_img'"/>				</xsl:apply-templates>			</a>			<!--div class="info">				<xsl:apply-templates select="." mode="big_preview_info"/>			</div-->		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="small_preview">		<xsl:param name="height" select="$small_preview_height"/>		<div id="m{@ID}">			<xsl:attribute name="class">				<xsl:value-of select="INFO/MEDIATYPE"/>				<xsl:text> small_preview gouttiere gouttiere_hor </xsl:text>				<xsl:if test="//NECTIL/this_script = 'Books.php'">					<xsl:for-each select="CATEGORIES/CATEGORY | DEPENDENCIES/DEPENDENCY/CONTACT">						<xsl:value-of select="concat(substring(name(), 1, 3),@ID)"/>						<xsl:text> </xsl:text>					</xsl:for-each>					<xsl:value-of select="DESCRIPTIONS/DESCRIPTION/CUSTOM/YEAR"/>				</xsl:if>			</xsl:attribute>			<a onmouseover="$('#m{@ID} h6').css('display', 'block');" onmouseout="$('#m{@ID} h6').css('display', 'none');">				<xsl:apply-templates select="." mode="href"/>				<h6>					<span>						<xsl:apply-templates select="." mode="title"/>					</span>				</h6>				<xsl:if test="INFO/MEDIATYPE = 'Paragraph'">					<xsl:apply-templates select="." mode="header"/>				</xsl:if>				<xsl:apply-templates select="." mode="visual">					<xsl:with-param name="height" select="$height"/>				</xsl:apply-templates>			</a>		</div>	</xsl:template>	<xsl:template name="next_arrow">		<img src="images/ar_right.png" alt="{//LABEL[@name='next']}"/>	</xsl:template>	<xsl:template name="prev_arrow">		<img src="images/ar_left.png" alt="{//LABEL[@name='previous']}"/>	</xsl:template>	<xsl:template match="DATA[@service='CATEGORY' and @path='book_theme']" mode="display_content">		<xsl:param name="element"/>		<label>			<xsl:apply-templates select="." mode="label"/>		</label>		<xsl:for-each select="$element/CATEGORIES//CATEGORY[contains(@path, current()/@path)]">			<xsl:value-of select="LABEL"/>			<xsl:call-template name="add_coma_if_not_last"/>		</xsl:for-each>	</xsl:template></xsl:stylesheet>