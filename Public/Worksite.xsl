<?xml version="1.0"?><xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">	<xsl:import href="common.xsl"/>	<xsl:param name="displayed_media">		<xsl:choose>			<xsl:when test="//URL/mID != ''">				<xsl:value-of select="//URL/mID"/>			</xsl:when>			<xsl:otherwise>				<xsl:for-each select="$media/DEPENDENCIES/DEPENDENCY/MEDIA[INFO/MEDIATYPE != 'Paragraph']">					<xsl:if test="position() = 1">						<xsl:value-of select="@ID"/>					</xsl:if>				</xsl:for-each>			</xsl:otherwise>		</xsl:choose>	</xsl:param>	<xsl:template match="/RESPONSE">		<xsl:call-template name="html"/>	</xsl:template>	<xsl:template match="MEDIA" mode="specific_head_content">		<script type="text/javascript" src="{//NECTIL/public_url}jquery.smoothanchors2.js">&#xA0;</script>		<script type="text/javascript">			<xsl:text>$(document).ready(function(){$.smoothAnchors("normal", "linear", false);});</xsl:text>		</script>	</xsl:template>	<xsl:template match="MEDIA[/RESPONSE/RESULTS[@name='media']/MEDIA/@ID = /RESPONSE/RESULTS[@name='website']/MEDIA/@ID]" mode="h1">		<xsl:variable name="text">			<xsl:apply-templates select="." mode="title"/>		</xsl:variable>		<h1>			<xsl:call-template name="titrage">				<xsl:with-param name="text" select="translate($text, $minuscules, $majuscules)"/>				<xsl:with-param name="color" select="$red"/>				<xsl:with-param name="size" select="24"/>				<xsl:with-param name="font" select="'book'"/>			</xsl:call-template>		</h1>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE='Website']" mode="body_attribute">		<xsl:variable name="number" select="count($media/DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[@ID = $displayed_media]/DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE)"/>		<xsl:variable name="gouttieres" select="$number * 5"/>		<xsl:attribute name="class">Worksite fix</xsl:attribute>		<xsl:attribute name="style">			<!-- depend du media affiché à revoir -->			<xsl:variable name="images_width" select="720"/>			<xsl:variable name="width" select="round($images_width * $number + 500)"/>			<xsl:text>width:</xsl:text>			<xsl:value-of select="$gouttieres + $width"/>			<xsl:text>px;</xsl:text>		</xsl:attribute>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and //URL/ID = @ID]" mode="bottom_script">		<script>			<xsl:text>resize_preview_image();</xsl:text>			<xsl:text>resize_body('specific');</xsl:text>		</script>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="bottom">		<xsl:if test="$media/@ID != $website/@ID">			<xsl:apply-templates select="." mode="bottom_script"/>		</xsl:if>		<xsl:apply-templates select="$media" mode="bottom_script"/>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website']" mode="content">		<div id="content">			<div id="displayed_content">				<xsl:for-each select="$media/DEPENDENCIES/DEPENDENCY/MEDIA[@ID = $displayed_media]">					<xsl:apply-templates select="." mode="h1"/>					<xsl:apply-templates select="." mode="header"/>					<xsl:choose>						<xsl:when test="INFO/MEDIATYPE = 'News'">						</xsl:when>						<xsl:otherwise>						</xsl:otherwise>					</xsl:choose>				</xsl:for-each>			</div>			<xsl:apply-templates select="$media/DEPENDENCIES/DEPENDENCY[@type='mediaContent']" mode="inside_navigation"/>		</div>		<div id="specific">			<xsl:apply-templates select="." mode="specific"/>		</div>	</xsl:template>	<xsl:template match="DEPENDENCY" mode="inside_navigation">		<xsl:param name="number" select="ceiling( count(MEDIA[@ID != $displayed_media]) div 2 )"/>		<div class="inside_navigation">			<div class="col gouttiere">				<xsl:for-each select="MEDIA[@ID != $displayed_media]">					<xsl:if test="position() &lt;= $number">						<xsl:apply-templates select="." mode="website_small_preview"/>					</xsl:if>				</xsl:for-each>			</div>			<div class="col">				<xsl:for-each select="MEDIA[@ID != $displayed_media]">					<xsl:if test="position() &gt; $number">						<xsl:apply-templates select="." mode="website_small_preview"/>					</xsl:if>				</xsl:for-each>			</div>		</div>	</xsl:template>	<xsl:template match="MEDIA" mode="website_small_preview">		<xsl:param name="width" select="125"/>		<div id="m{@ID}">			<xsl:attribute name="class">				<xsl:value-of select="INFO/MEDIATYPE"/>				<xsl:text> small_preview gouttiere_hor </xsl:text>			</xsl:attribute>			<xsl:choose>				<xsl:when test="INFO/MEDIATYPE = 'Paragraph'">					<xsl:apply-templates select="." mode="header"/>				</xsl:when>				<xsl:otherwise>					<a href="{//NECTIL/this_script}?ID={//URL/ID}&amp;mID={@ID}">						<xsl:apply-templates select="." mode="visual">							<xsl:with-param name="width" select="$width"/>						</xsl:apply-templates>						<h4>							<xsl:apply-templates select="." mode="title"/>						</h4>					</a>				</xsl:otherwise>			</xsl:choose>		</div>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA]" mode="specific">		<!-- pointer l'ID à afficher ? ou on affiche tout avec un bel effet jquery power motherfucker -->		<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[@ID = $displayed_media]" mode="in_website_content"/>	</xsl:template>	<xsl:template match="MEDIA" mode="in_website_content">		<xsl:apply-templates select="DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE" mode="big_preview"/>	</xsl:template>	<xsl:template match="MEDIA[ DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[INFO/MEDIATYPE = 'Image'] ]" mode="in_website_content">		<xsl:apply-templates select="DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA[INFO/MEDIATYPE = 'Image']" mode="big_preview"/>	</xsl:template>	<xsl:template match="MEDIA[not( DESCRIPTIONS/DESCRIPTION/CUSTOM/TREE/FILE )]" mode="in_website_content">		<xsl:apply-templates select="." mode="big_preview">			<xsl:with-param name="display_info" select="0"/>			<xsl:with-param name="alone" select="1"/>		</xsl:apply-templates>	</xsl:template>	<xsl:template match="MEDIA[INFO/MEDIATYPE = 'Website' and not(DEPENDENCIES/DEPENDENCY[@type='mediaContent']/MEDIA)]" mode="big_preview">		<xsl:apply-templates select="$data" mode="website_preview"/>	</xsl:template></xsl:stylesheet>